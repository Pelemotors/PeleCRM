# PeleCRM
הנה **מסמך אפיון טכני מלא, מקצועי וריכוזי** של כל מערכת ה־CRM החכמה שהגדרנו, כולל כל מה שדובר:

---

# 📄 אפיון טכני מלא – CRM חכם למוכרי שטח מבוסס WhatsApp

---

## 1. 🎯 מטרת המערכת

לאפשר לסוכני שטח (רכב, ביטוח, מימון) לנהל, לעקוב ולדווח על בקשות מימון באופן אוטומטי – על בסיס הודעות שמתקבלות בקבוצות וואטסאפ – מבלי להזין נתונים ידנית.

המערכת:

* מאזינה להודעות ולקבצים מקבוצות וואטסאפ
* מזהה בקשות מימון חדשות
* תיעוד, סטטוס, תזכורות SLA
* מאפשרת עדכון ידני מממשק Web
* שולחת דוחות אוטומטיים

---

## 2. 🧱 מבנה כללי של המערכת

### 2.1 רכיבים עיקריים:

| רכיב           | תיאור                                                    |
| -------------- | -------------------------------------------------------- |
| 🧠 Listener    | תהליך רץ על שרת VPS – מאזין לוואטסאפ דרך whatsapp-web.js |
| 🌐 Dashboard   | ממשק Web מלא לצפייה, עריכה ודוחות – נגיש מהנייד          |
| 🗄️ DB מרכזי   | מסד נתונים מרכזי (PostgreSQL / MariaDB) בענן             |
| 📤 XLSX Engine | מערכת שמפיקה דוחות אוטומטיים כל שעה ודוח יומי            |

---

## 3. 🔁 זרימת תהליך – תיעוד חכם (Smart Logging Flow)

1. לקוח שולח הודעה בקבוצת וואטסאפ → Listener מאזין
2. ניתוח הודעה:

   * מילות מפתח (מימון, ת.ז, שלחתי, תלוש)
   * קבצים מצורפים (תמונות / PDF)
3. אם ההודעה נחשבת בקשה → נוצרת רשומת טיוטה
4. Listener מאזין להודעות נוספות בקבוצה:

   * אם מזוהה תגובה: "אושר", "בוצע", "לא מתאים"
   * המערכת מנסה לשייך את התגובה לבקשה → אם הצליחה → עדכון סטטוס
   * אם יש ספק → נשלחת הודעת ווידוא חכמה בקבוצה
5. אם לא עודכן סטטוס תוך X שעות → תזכורת SLA
6. כל שעה: נשלח דוח אקסל לסוכן עם כלל הבקשות והסטטוסים

---

## 4. 📥 קלטים

| מקור              | סוג               | הסבר                        |
| ----------------- | ----------------- | --------------------------- |
| WhatsApp Listener | טקסט, תמונות, PDF | הודעות מכל הקבוצות          |
| דפדפן הסוכן       | הזנת טופס         | עדכון/השלמה של פרטים ידניים |
| מערכת תזכורות     | זמן               | ניהול SLA ומעקב             |

---

## 5. 📤 פלטים

### דוח אקסל (xlsx) כל שעה

* נשלח לקבוצה האישית של הסוכן
* כולל:

  * מזהה בקשה
  * קבוצה ממנה הגיעה
  * שעה, סטטוס, סכומים
  * קבצים מצורפים
* כולל שורת סיכום:

  * סה"כ בקשות
  * סה"כ מימון מבוקש
  * סה"כ מימון שאושר
  * סה"כ מומש

---

## 6. 📊 מבנה בסיס נתונים (DB Schema)

### טבלת `loan_requests`

| שדה                | סוג      | תיאור                                   |
| ------------------ | -------- | --------------------------------------- |
| id                 | UUID     | מזהה ייחודי                             |
| group\_name        | TEXT     | שם קבוצה                                |
| timestamp\_created | DATETIME | מתי הבקשה התקבלה                        |
| amount\_requested  | INT      | סכום מבוקש                              |
| amount\_approved   | INT      | סכום שאושר (אם קיים)                    |
| status             | ENUM     | טיוטה / בטיפול / אושרה / נדחתה / הופעלה |
| num\_files         | INT      | כמה קבצים צורפו                         |
| confirmed\_by      | TEXT     | לקוח / סוכן / אוטומטי                   |
| client\_name       | TEXT     | שם הלקוח (אם קיים)                      |
| notes              | TEXT     | הערות חופשיות                           |
| updated\_at        | DATETIME | מתי עודכן לאחרונה                       |

---

## 7. 🌐 Dashboard Web App

| מסך             | פעולות                                          |
| --------------- | ----------------------------------------------- |
| Dashboard       | צפייה בכל הבקשות, סינון לפי סטטוס/קבוצה/זמן     |
| עריכת בקשה      | עדכון שם, סכום, סטטוס, הערות                    |
| הגדרות          | הגדרת SLA ברירת מחדל, קבוצות פעילות, מילות מפתח |
| היסטוריית דוחות | הורדת XLSX לפי שעה/יום                          |
| התראות SLA      | רשימת בקשות שעברו את זמן הטיפול                 |

---

## 8. 🤖 Smart Confirmation Logic

* כאשר יש יותר מבקשה אחת מאותה קבוצה:

  * המערכת מזהה תגובה (למשל "אושר")
  * שואלת בקבוצה:

    ```
    🤖 יש 2 בקשות פעילות:
    1. ג. כהן – 70K מ-10:12
    2. ר. פרץ – 90K מ-12:45
    אנא אשר באיזו הכוונה (1 / 2)
    ```
* ברגע שניתן אישור – הבקשה הנכונה מתעדכנת

---

## 9. 🛠️ טכנולוגיות מוצעות

| חלק      | טכנולוגיה                                       |
| -------- | ----------------------------------------------- |
| Listener | Node.js + whatsapp-web.js + puppeteer           |
| Web      | React (Next.js) + Tailwind                      |
| API      | Flask או FastAPI או Express.js                  |
| DB       | PostgreSQL או MariaDB                           |
| XLSX     | openpyxl / pandas (Python) או exceljs (Node.js) |

---

## 10. 🧠 שיפור עתידי (שלבים הבאים)

* מעבר להרצת listener על VPS בענן לכל סוכן (עם סשן משלו)
* חיבור אוטומטי ל־Google Drive לשמירת קבצים
* OCR לזיהוי ת"ז / תלושים מהקבצים
* מנגנון המלצות לסוכן (למשל: "לטפל קודם בפנייה X")

---

✅ מוכן להפיק גרסת דמו ראשונית של המערכת?
או שנעבור לבניית תרשים ארכיטקטורה (infrastructure + data flow)?
